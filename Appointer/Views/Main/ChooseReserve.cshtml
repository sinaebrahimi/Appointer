@model Appointer.Models.Appointment

@{
    //ViewBag.Title = "رزرو وقت";
    //string StartHHmm = item.StartTime.ToString("HH:mm");
    //ViewBag.Title = Model.Service.JobCorp.User.FullName;
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<div class="fullpage-form">
    <div class="info">
        <div class="info-title"><strong>رزرو وقت</strong></div>
        <hr>
    </div>

    @ViewBag.Error
    @ViewBag.Message
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()


        <div class="col-sm-4 col-sm-offset-4">
            <div class="col-xs-12">



                <br />
                @Html.LabelFor(model => model.myDate)
                <br />
                <select name="selDate" id="selDate">  @*onchange = "javascript:Function();"*@

                    <option value="notset" selected="selected">لطفا یک تاریخ را انتخاب کنید</option>
                    @foreach (Appointer.Models.WorkingTime wt in ViewBag.WorkingTimes)
                    {
                        string sdate = wt.StartTime.ToPersianDateTime().ToString("yyyy/MM/dd");
                        <option value="@wt.Id">@sdate</option>

                    }
                </select>
                <br />
                <div class="ajaxRes"></div>
                <br/>

                <div class="input-group clockpicker">

                    @Html.EditorFor(model => model.start, new
                   {
                       @class = "form-control",
                       value = "09:30"
                   })
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-time"></span>
                    </span>
                </div>

                @Html.LabelFor(model => model.ServiceId)
                <br />
                <select name="ServiceId" id="ServiceId">
                    @foreach (Appointer.Models.Service s in ViewBag.Services)
                    {
                        <option value="@s.Id">@s.Title @Html.Raw(" - ") @s.Duration @Html.Raw(" دقیقه")</option>
                    }
                </select>
                <br />

                @Html.LabelFor(model => model.Description)
                @Html.TextAreaFor(model => model.Description)
                <br />
                <br />
            </div>


            <div class="col-xs-8 col-xs-offset-2">
                <button class="btn btn-sm btn-primary btn-block" type="submit" value="Reserver">رزرو وقت</button>

            </div>
        </div>
    }



</div>


@section styles{
    <link href="~/Scripts/JsDatePicker/PersianDatePicker.min.css" rel="stylesheet" />
    <link href="~/Scripts/JsDatePicker/clockpicker.css" rel="stylesheet" />

}


@section Scripts {

    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/JsDatePicker/PersianDatePicker.min.js"></script>

    <script src="~/Scripts/JsDatePicker/clockpicker.js"></script>
    <script type="text/javascript">
        $('.clockpicker').clockpicker();
        $(document).ready(function () {
            var url = '@Url.Action("JsonInfo")'; // add controller name is necessary
            $('#selDate').change(function () {
                $.getJSON(url, { wtid: $('#selDate').val() }, function (response) {
                    //alert(response);
                    if (response == false) {

                        $(".ajaxRes").html("<span style='color: red;'>چنین زمان کاری ای وجود ندارد</span>");

                    }
                    else
                    {
                        $(".ajaxRes").html(response.dow + "<span> از </span>" + response.StartTime + "<span> تا </span>" + response.EndTime + "<br/>" + response.JobTitle + "<br/>" + response.JobCorp);
                        if (response.ap.length > 0) {
                            $(".ajaxRes").append("<hr><span style='color:blue;'>دیگر قرارهای این روز</span><br/>");
                        }
                        for (var j = 0; j < response.ap.length ; j++) {
                            $(".ajaxRes").append(response.ap[j].StartHour + " تا " + response.ap[j].EndHour + "<br/>");
                        }
                    }
                });
            });
        });

    </script>

}
